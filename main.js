!function(){"use strict";const e={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error"},t={profileEditForm:document.forms["profile-form"],addCardForm:document.forms["card-form"],avatarEditForm:document.querySelector("#edit-avatar-form"),profileEditButton:document.querySelector("#profile-edit-button"),addCardButton:document.querySelector("#profile-add-button"),profileTitle:document.querySelector(".profile__title"),profileDescription:document.querySelector(".profile__description"),profileTitleInput:document.querySelector("#profile-title-input"),profileDescriptionInput:document.querySelector("#profile-description-input"),cardListEl:document.querySelector(".cards__list"),addCardTitleInput:document.querySelector("#add-card-title"),addCardUrlInput:document.querySelector("#add-card-url")};class r{constructor(e,t,r,s,i,n){let{name:o,link:a,_id:l,isLiked:d,likes:c=[],owner:h}=e;this._name=o,this._link=a,this._id=l,this._isLiked=d,this._likes=c,this._owner=h,this._currentUserId=s,this._cardSelector=t,this._handleImageClick=r,this._api=i,this._handleDeleteCard=n}setLikeState(){this._isLiked?this._likeButton.classList.add("card__like-button_active"):this._likeButton.classList.remove("card__like-button_active")}toggleLike(){this._isLiked?this._api.dislikeCard(this._id).then((e=>{this._isLiked=e.isLiked,this.setLikeState()})).catch((e=>console.error(`Error unliking card: ${e}`))):this._api.likeCard(this._id).then((e=>{this._isLiked=e.isLiked,this.setLikeState()})).catch((e=>console.error(`Error liking card: ${e}`)))}setEventListeners(){this._likeButton.addEventListener("click",(()=>{this.toggleLike()})),this._owner===this._currentUserId&&this._trashButton.addEventListener("click",(()=>this._handleDeleteCard(this._cardElement,this._id))),this._cardImageEl.addEventListener("click",(()=>this._handleImageClick(this._link,this._name)))}getView(){return this.createCardElement(),this.setEventListeners(),this._cardElement}createCardElement(){const e=document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0);return this._cardElement=e,this._likeButton=this._cardElement.querySelector(".card__like-button"),this._trashButton=this._cardElement.querySelector(".card__trash-button"),this._cardImageEl=this._cardElement.querySelector(".card__image"),this._cardTitleEl=this._cardElement.querySelector(".card__title"),this._cardTitleEl.textContent=this._name,this._cardImageEl.src=this._link,this._cardImageEl.alt=this._name,this.setLikeState(),this._cardElement}}class s{constructor(e,t){this._settings=e,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._settings.inputSelector)),this._submitButton=this._formElement.querySelector(this._settings.submitButtonSelector)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?this.disableButton():(this._submitButton.classList.remove(this._settings.inactiveButtonClass),this._submitButton.disabled=!1)}_checkInputValidity(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.validity.valid?(e.classList.remove(this._settings.inputErrorClass),t.textContent=""):(e.classList.add(this._settings.inputErrorClass),t.textContent=e.validationMessage)}_setEventListeners(){this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._setEventListeners()}resetValidation(){this._inputList.forEach((e=>{const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._settings.inputErrorClass),t.textContent=""})),this._toggleButtonState()}disableButton(){this._submitButton.classList.add(this._settings.inactiveButtonClass),this._submitButton.disabled=!0}}class i{constructor(e){this._popupElement=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popupElement.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popupElement.querySelector(".popup__close").addEventListener("click",(()=>{this.close()})),this._popupElement.addEventListener("mousedown",(e=>{e.target===this._popupElement&&this.close()}))}}class n extends i{constructor(e,t){super(e),this.handleFormSubmit=t,this.formElement=this._popupElement.querySelector(".popup__form")||null,this.formElement&&(this._submitBtn=this.formElement.querySelector(".popup__button"),this._submitBtnText=this._submitBtn.textContent),this.formElement&&(this.inputList=Array.from(this.formElement.querySelectorAll(".popup__input")))}__getInputValues(){const e={};return this.formElement&&this.inputList.forEach((t=>{e[t.name]=t.value})),e}renderLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Saving...";this._submitBtn.textContent=e?t:this._submitBtnText}setEventListeners(){super.setEventListeners(),this.formElement&&this.formElement.addEventListener("submit",(e=>{e.preventDefault(),this.handleFormSubmit(this.__getInputValues())}))}resetForm(){this.formElement&&this.formElement.reset()}}const o=new class{constructor(e){let{baseUrl:t,headers:r}=e;this.baseUrl=t,this.headers=r}_request(e,t){return fetch(e,t).then(this._checkResponse)}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}_handleError(e){return console.error(e),Promise.reject(e)}getInitialCards(){return this._request(`${this.baseUrl}/cards`,{headers:this.headers}).catch(this._handleError)}getUserInfo(){return this._request(`${this.baseUrl}/users/me`,{headers:this.headers}).catch(this._handleError)}updateUserInfo(e){let{name:t,about:r}=e;return this._request(`${this.baseUrl}/users/me`,{method:"PATCH",headers:this.headers,body:JSON.stringify({name:t,about:r})}).catch(this._handleError)}addCard(e){let{name:t,link:r}=e;return this._request(`${this.baseUrl}/cards`,{method:"POST",headers:this.headers,body:JSON.stringify({name:t,link:r})}).catch(this._handleError)}deleteCard(e){return this._request(`${this.baseUrl}/cards/${e}`,{method:"DELETE",headers:this.headers}).catch(this._handleError)}likeCard(e){return this._request(`${this.baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this.headers}).catch(this._handleError)}dislikeCard(e){return this._request(`${this.baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this.headers}).catch(this._handleError)}updateAvatar(e){return this._request(`${this.baseUrl}/users/me/avatar`,{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:e})}).catch(this._handleError)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"765a56ab-1403-4444-8fac-5fc1871e9695","Content-Type":"application/json"}}),{addCardForm:a,addCardButton:l,avatarEditForm:d,profileEditForm:c,profileEditButton:h,profileTitleInput:u,profileDescriptionInput:_}=t,m=document.querySelector("#edit-avatar-button"),p=new class{constructor(e){let{nameSelector:t,descriptionSelector:r,avatarSelector:s}=e;this._nameElement=document.querySelector(t),this._descriptionElement=document.querySelector(r),this._avatarElement=document.querySelector(s)}getUserInfo(){return{name:this._nameElement.textContent,description:this._descriptionElement.textContent,avatar:this._avatarElement.src}}setUserInfo(e){let{name:t,description:r,avatar:s}=e;this._nameElement.textContent=t,this._descriptionElement.textContent=r,this._avatarElement.src=s}}({nameSelector:".profile__title",descriptionSelector:".profile__description",avatarSelector:".profile__image"}),E=new class extends i{constructor(e){super(e),this.confirmButton=this._popupElement.querySelector(".popup__button_confirm-delete"),this.handleConfirm=null}setConfirmHandler(e){this.handleConfirm=e,this.confirmButton.removeEventListener("click",this._boundHandleConfirm),this._boundHandleConfirm=()=>{this.handleConfirm()},this.confirmButton.addEventListener("click",this._boundHandleConfirm,{once:!0})}setEventListeners(){super.setEventListeners()}}("#delete-card-popup");E.setEventListeners();const f=(e,t)=>{E.setConfirmHandler((()=>{o.deleteCard(t).then((()=>{e.remove(),E.close()})).catch((e=>console.error(`Error deleting card: ${e}`)))})),E.open()},v=e=>new r({name:e.name,link:e.link,_id:e._id,owner:e.owner,isLiked:e.isLiked},"#card-template",g,k,o,f).getView(),L=new class{constructor(e,t){let{renderer:r}=e;this._renderer=r,this._container=document.querySelector(t)}renderItems(e){e.forEach((e=>this._renderer(e)))}addItem(e){this._container.prepend(e)}}({renderer:e=>{const t=v(e);L.addItem(t)}},".cards__list");let k;o.getUserInfo().then((e=>(p.setUserInfo({name:e.name,description:e.about,avatar:e.avatar}),k=e._id,o.getInitialCards()))).then((e=>{L.renderItems(e.reverse())})).catch((e=>console.error("Error fetching user info or cards:",e)));const g=(e,t)=>{y.open({name:t,link:e})},b=new n("#profile-edit-popup",(e=>{b.renderLoading(!0),o.updateUserInfo({name:e.name,about:e.description}).then((e=>{p.setUserInfo({name:e.name,description:e.about,avatar:e.avatar}),b.close(),b.resetForm()})).catch((e=>{console.error("Error updating profile:",e)})).finally((()=>{b.renderLoading(!1)}))}));b.setEventListeners();const S=new n("#add-card-popup",(e=>{S.renderLoading(!0),o.addCard({name:e.title,link:e.url}).then((e=>{const t=v({name:e.name,link:e.link,_id:e._id,owner:e.owner,likes:e.likes});L.addItem(t),S.close(),S.resetForm(),I.disableButton()})).catch((e=>{console.error("Error adding card:",e)})).finally((()=>{S.renderLoading(!1)}))}));S.setEventListeners();const C=new n("#avatar-edit-popup",(e=>{C.renderLoading(!0),o.updateAvatar(e.avatar).then((e=>{p.setUserInfo({name:e.name,description:e.about,avatar:e.avatar}),C.close(),d.reset()})).catch((e=>console.error("Error updating avatar:",e))).finally((()=>{C.renderLoading(!1)}))}));C.setEventListeners(),m.addEventListener("click",(()=>{B.resetValidation(),C.open()}));const y=new class extends i{constructor(e){super(e),this._imageElement=this._popupElement.querySelector(".popup__image"),this._captionElement=this._popupElement.querySelector(".popup__caption")}open(e){let{name:t,link:r}=e;this._imageElement.src=r,this._imageElement.alt=t,this._captionElement.textContent=t,super.open()}}("#picture-popup");y.setEventListeners();const q=new s(e,c),I=new s(e,a),B=new s(e,d);q.enableValidation(),I.enableValidation(),B.enableValidation(),h.addEventListener("click",(()=>{const e=p.getUserInfo();u.value=e.name,_.value=e.description,q.resetValidation(),b.open()})),l.addEventListener("click",(()=>{S.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LG9CQUdoQnFHLEVBQWlCcEcsaUJBQWlCLFNBQVMsS0FDekMrSSxFQUFvQnpHLGtCQUNwQndHLEVBQWdCbEcsTUFBTSxJQUl4QixNQUFNeUYsRUFBdUIsSUt6TmQsY0FBNkI5RixFQUUxQzlFLFdBQUFBLENBQVkrRSxHQUVWWSxNQUFNWixHQUdObEUsS0FBSzBLLGNBQWdCMUssS0FBS21FLGNBQWMzRixjQUFjLGlCQUd0RHdCLEtBQUsySyxnQkFBa0IzSyxLQUFLbUUsY0FBYzNGLGNBQWMsa0JBQzFELENBR0E4RixJQUFBQSxDQUFJbEYsR0FBaUIsSUFBaEIsS0FBRU0sRUFBSSxLQUFFQyxHQUFNUCxFQUVqQlksS0FBSzBLLGNBQWNySSxJQUFNMUMsRUFHekJLLEtBQUswSyxjQUFjcEksSUFBTTVDLEVBR3pCTSxLQUFLMkssZ0JBQWdCdkksWUFBYzFDLEVBR25Db0YsTUFBTVIsTUFDUixHTCtMOEMsa0JBQ2hEeUYsRUFBcUJ0SSxvQkFHckIsTUFBTW1KLEVBQXVCLElBQUlySSxFQUMvQjNFLEVBQ0FPLEdBRUlvTSxFQUFvQixJQUFJaEksRUFDNUIzRSxFQUNBVSxHQUVJbU0sRUFBc0IsSUFBSWxJLEVBQzlCM0UsRUFDQVcsR0FJRnFNLEVBQXFCN0csbUJBQ3JCd0csRUFBa0J4RyxtQkFDbEIwRyxFQUFvQjFHLG1CQUdwQnRGLEVBQWtCaUQsaUJBQWlCLFNBcklUbUosS0FDeEIsTUFBTUMsRUFBVy9DLEVBQWlCakIsY0FDbENqSSxFQUFrQndHLE1BQVF5RixFQUFTcEwsS0FDbkNaLEVBQXdCdUcsTUFBUXlGLEVBQVN4QyxZQUN6Q3NDLEVBQXFCNUcsa0JBQ3JCZ0csRUFBeUIxRixNQUFNLElBaUlqQzVGLEVBQWNnRCxpQkFBaUIsU0FBUyxLQUN0QzBJLEVBQXFCOUYsTUFBTSxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL3V0aWxzL3V0aWxzLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9BcGkuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoQ29uZmlybWF0aW9uLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IGZvcm1WYWxpZGF0aW9uU2V0dGluZ3MgPSB7XHJcbiAgZm9ybVNlbGVjdG9yOiBcIi5wb3B1cF9fZm9ybVwiLFxyXG4gIGlucHV0U2VsZWN0b3I6IFwiLnBvcHVwX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5wb3B1cF9fYnV0dG9uXCIsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJwb3B1cF9fYnV0dG9uX2Rpc2FibGVkXCIsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiBcInBvcHVwX19pbnB1dF90eXBlX2Vycm9yXCIsXHJcbn07XHJcblxyXG4vLyBFbGVtZW50IFNlbGVjdG9yc1xyXG5leHBvcnQgY29uc3Qgc2VsZWN0b3JzID0ge1xyXG4gIHByb2ZpbGVFZGl0Rm9ybTogZG9jdW1lbnQuZm9ybXNbXCJwcm9maWxlLWZvcm1cIl0sXHJcbiAgYWRkQ2FyZEZvcm06IGRvY3VtZW50LmZvcm1zW1wiY2FyZC1mb3JtXCJdLFxyXG4gIGF2YXRhckVkaXRGb3JtOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtYXZhdGFyLWZvcm1cIiksXHJcbiAgcHJvZmlsZUVkaXRCdXR0b246IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1lZGl0LWJ1dHRvblwiKSxcclxuICBhZGRDYXJkQnV0dG9uOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtYWRkLWJ1dHRvblwiKSxcclxuICBwcm9maWxlVGl0bGU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fdGl0bGVcIiksXHJcbiAgcHJvZmlsZURlc2NyaXB0aW9uOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpLFxyXG4gIHByb2ZpbGVUaXRsZUlucHV0OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtdGl0bGUtaW5wdXRcIiksXHJcbiAgcHJvZmlsZURlc2NyaXB0aW9uSW5wdXQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1kZXNjcmlwdGlvbi1pbnB1dFwiKSxcclxuICBjYXJkTGlzdEVsOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saXN0XCIpLFxyXG4gIGFkZENhcmRUaXRsZUlucHV0OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2FkZC1jYXJkLXRpdGxlXCIpLFxyXG4gIGFkZENhcmRVcmxJbnB1dDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC11cmxcIiksXHJcbn07XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcmQge1xyXG4gIC8vIENvbnN0cnVjdG9yIGluaXRpYWxpemVzIHRoZSBjYXJkIG9iamVjdCB3aXRoIGl0cyBwcm9wZXJ0aWVzIGFuZCBoYW5kbGVzIHBhc3NlZCBhcyBhcmd1bWVudHNcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHsgbmFtZSwgbGluaywgX2lkLCBpc0xpa2VkLCBsaWtlcyA9IFtdLCBvd25lciB9LFxyXG4gICAgY2FyZFNlbGVjdG9yLFxyXG4gICAgaGFuZGxlSW1hZ2VDbGljayxcclxuICAgIGN1cnJlbnRVc2VySWQsXHJcbiAgICBhcGksXHJcbiAgICBoYW5kbGVEZWxldGVDYXJkXHJcbiAgKSB7XHJcbiAgICB0aGlzLl9uYW1lID0gbmFtZTsgLy8gQ2FyZCdzIG5hbWUvdGl0bGVcclxuICAgIHRoaXMuX2xpbmsgPSBsaW5rOyAvLyBVUkwgdG8gdGhlIGNhcmQncyBpbWFnZVxyXG4gICAgdGhpcy5faWQgPSBfaWQ7IC8vIFVuaXF1ZSBJRCBvZiB0aGUgY2FyZFxyXG4gICAgdGhpcy5faXNMaWtlZCA9IGlzTGlrZWQ7IC8vIFdoZXRoZXIgdGhlIGN1cnJlbnQgdXNlciBoYXMgbGlrZWQgdGhlIGNhcmRcclxuICAgIHRoaXMuX2xpa2VzID0gbGlrZXM7IC8vIEFycmF5IG9mIHVzZXJzIHdobyBoYXZlIGxpa2VkIHRoZSBjYXJkXHJcbiAgICB0aGlzLl9vd25lciA9IG93bmVyOyAvLyBJRCBvZiB0aGUgdXNlciB3aG8gb3ducyB0aGUgY2FyZFxyXG4gICAgdGhpcy5fY3VycmVudFVzZXJJZCA9IGN1cnJlbnRVc2VySWQ7IC8vIElEIG9mIHRoZSBjdXJyZW50IHVzZXIgKHRvIGNoZWNrIG93bmVyc2hpcClcclxuICAgIHRoaXMuX2NhcmRTZWxlY3RvciA9IGNhcmRTZWxlY3RvcjsgLy8gVGVtcGxhdGUgc2VsZWN0b3IgZm9yIGNyZWF0aW5nIHRoZSBjYXJkXHJcbiAgICB0aGlzLl9oYW5kbGVJbWFnZUNsaWNrID0gaGFuZGxlSW1hZ2VDbGljazsgLy8gRnVuY3Rpb24gdG8gaGFuZGxlIGltYWdlIGNsaWNrIGV2ZW50cyAoZm9yIG9wZW5pbmcgYSBsYXJnZXIgaW1hZ2UpXHJcbiAgICB0aGlzLl9hcGkgPSBhcGk7IC8vIFJlZmVyZW5jZSB0byB0aGUgQVBJIGNsYXNzIHRvIG1ha2UgbGlrZS91bmxpa2UgcmVxdWVzdHNcclxuICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNhcmQgPSBoYW5kbGVEZWxldGVDYXJkOyAvLyBGdW5jdGlvbiB0byBoYW5kbGUgY2FyZCBkZWxldGlvblxyXG4gIH1cclxuXHJcbiAgLy8gUHJpdmF0ZSBtZXRob2QgdG8gdXBkYXRlIHRoZSBsaWtlIGJ1dHRvbidzIHN0YXRlIChhY3RpdmUgaWYgbGlrZWQpXHJcbiAgc2V0TGlrZVN0YXRlKCkge1xyXG4gICAgaWYgKHRoaXMuX2lzTGlrZWQpIHtcclxuICAgICAgdGhpcy5fbGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpOyAvLyBBZGRzIHRoZSBhY3RpdmUgY2xhc3MgdG8gZmlsbCB0aGUgaGVhcnRcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2xpa2VCdXR0b24uY2xhc3NMaXN0LnJlbW92ZShcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTsgLy8gUmVtb3ZlcyB0aGUgYWN0aXZlIGNsYXNzIHRvIHVuZmlsbCB0aGUgaGVhcnRcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIFByaXZhdGUgbWV0aG9kIHRvIHRvZ2dsZSBsaWtlL3VubGlrZSBiZWhhdmlvclxyXG4gIHRvZ2dsZUxpa2UoKSB7XHJcbiAgICBpZiAodGhpcy5faXNMaWtlZCkge1xyXG4gICAgICAvLyBJZiBjYXJkIGlzIGxpa2VkLCBzZW5kIHJlcXVlc3QgdG8gdW5saWtlIHRoZSBjYXJkXHJcbiAgICAgIHRoaXMuX2FwaVxyXG4gICAgICAgIC5kaXNsaWtlQ2FyZCh0aGlzLl9pZClcclxuICAgICAgICAudGhlbigodXBkYXRlZENhcmQpID0+IHtcclxuICAgICAgICAgIC8vIHRoaXMuX2lzTGlrZWQgPSBmYWxzZTsgLy8gVXBkYXRlIGxvY2FsIGxpa2Ugc3RhdGVcclxuICAgICAgICAgIHRoaXMuX2lzTGlrZWQgPSB1cGRhdGVkQ2FyZC5pc0xpa2VkOyAvLyBVcGRhdGUgbGlrZXMgYXJyYXlcclxuICAgICAgICAgIHRoaXMuc2V0TGlrZVN0YXRlKCk7IC8vIFJlIHJlbmRlciBsaWtlIHN0YXRlXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihgRXJyb3IgdW5saWtpbmcgY2FyZDogJHtlcnJ9YCkpOyAvLyBIYW5kbGUgZXJyb3JzXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBJZiBjYXJkIGlzIG5vdCBsaWtlZCwgc2VuZCByZXF1ZXN0IHRvIGxpa2UgdGhlIGNhcmRcclxuICAgICAgdGhpcy5fYXBpXHJcbiAgICAgICAgLmxpa2VDYXJkKHRoaXMuX2lkKVxyXG4gICAgICAgIC50aGVuKCh1cGRhdGVkQ2FyZCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5faXNMaWtlZCA9IHVwZGF0ZWRDYXJkLmlzTGlrZWQ7IC8vIFVwZGF0ZSB0aGUgaXNMaWtlZCBwcm9wZXJ0eSBmcm9tIHRoZSByZXNwb25zZVxyXG4gICAgICAgICAgLy8gdGhpcy5fbGlrZXMgPSB1cGRhdGVkQ2FyZC5saWtlcyB8fCBbXTsgLy8gVXBkYXRlIGxpa2VzIGFycmF5XHJcbiAgICAgICAgICB0aGlzLnNldExpa2VTdGF0ZSgpOyAvLyBSZSByZW5kZXIgbGlrZSBzdGF0ZVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoYEVycm9yIGxpa2luZyBjYXJkOiAke2Vycn1gKSk7IC8vIEhhbmRsZSBlcnJvcnNcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIFByaXZhdGUgbWV0aG9kIHRvIHNldCB1cCBldmVudCBsaXN0ZW5lcnMgZm9yIGNhcmQgYWN0aW9uc1xyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgLy8gTGlzdGVuIGZvciBsaWtlIGJ1dHRvbiBjbGlja3MgdG8gdG9nZ2xlIGxpa2UvdW5saWtlXHJcbiAgICB0aGlzLl9saWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIHRoaXMudG9nZ2xlTGlrZSgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gSWYgdGhlIGNhcmQgYmVsb25ncyB0byB0aGUgY3VycmVudCB1c2VyLCBzZXQgdXAgdGhlIGRlbGV0ZSBidXR0b25cclxuICAgIGlmICh0aGlzLl9vd25lciA9PT0gdGhpcy5fY3VycmVudFVzZXJJZCkge1xyXG4gICAgICB0aGlzLl90cmFzaEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFxyXG4gICAgICAgIFwiY2xpY2tcIixcclxuICAgICAgICAoKSA9PiB0aGlzLl9oYW5kbGVEZWxldGVDYXJkKHRoaXMuX2NhcmRFbGVtZW50LCB0aGlzLl9pZCkgLy8gQ2FsbCBkZWxldGUgaGFuZGxlciB3aXRoIGNhcmQgaW5mb1xyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIExpc3RlbiBmb3IgaW1hZ2UgY2xpY2tzIHRvIG9wZW4gYSBsYXJnZXIgdmlldyBvZiB0aGUgaW1hZ2VcclxuICAgIHRoaXMuX2NhcmRJbWFnZUVsLmFkZEV2ZW50TGlzdGVuZXIoXHJcbiAgICAgIFwiY2xpY2tcIixcclxuICAgICAgKCkgPT4gdGhpcy5faGFuZGxlSW1hZ2VDbGljayh0aGlzLl9saW5rLCB0aGlzLl9uYW1lKSAvLyBDYWxsIGltYWdlIGNsaWNrIGhhbmRsZXJcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvLyBQdWJsaWMgbWV0aG9kIHRvIGNyZWF0ZSB0aGUgY2FyZCB2aWV3IGFuZCBzZXQgdXAgZXZlbnQgbGlzdGVuZXJzXHJcbiAgZ2V0VmlldygpIHtcclxuICAgIHRoaXMuY3JlYXRlQ2FyZEVsZW1lbnQoKTsgLy8gQ3JlYXRlIHRoZSBjYXJkIGVsZW1lbnRcclxuICAgIHRoaXMuc2V0RXZlbnRMaXN0ZW5lcnMoKTsgLy8gQXR0YWNoIGV2ZW50IGxpc3RlbmVycyB0byB0aGUgY2FyZFxyXG4gICAgcmV0dXJuIHRoaXMuX2NhcmRFbGVtZW50OyAvLyBSZXR1cm4gdGhlIGNyZWF0ZWQgY2FyZCBlbGVtZW50XHJcbiAgfVxyXG5cclxuICAvLyBQcml2YXRlIG1ldGhvZCB0byBjcmVhdGUgYW5kIHJldHVybiB0aGUgY2FyZCBlbGVtZW50IGZyb20gdGhlIHRlbXBsYXRlXHJcbiAgY3JlYXRlQ2FyZEVsZW1lbnQoKSB7XHJcbiAgICBjb25zdCBjYXJkRWxlbWVudCA9IGRvY3VtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcikgLy8gU2VsZWN0IHRoZSBjYXJkIHRlbXBsYXRlXHJcbiAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKSAvLyBTZWxlY3QgdGhlIGNhcmQgc3RydWN0dXJlIGluc2lkZSB0aGUgdGVtcGxhdGVcclxuICAgICAgLmNsb25lTm9kZSh0cnVlKTsgLy8gQ2xvbmUgdGhlIHN0cnVjdHVyZSB0byBjcmVhdGUgYSBuZXcgY2FyZFxyXG5cclxuICAgIC8vIFN0b3JlIHJlZmVyZW5jZXMgdG8gdmFyaW91cyBjYXJkIGVsZW1lbnRzXHJcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IGNhcmRFbGVtZW50O1xyXG4gICAgdGhpcy5fbGlrZUJ1dHRvbiA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XHJcbiAgICB0aGlzLl90cmFzaEJ1dHRvbiA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdHJhc2gtYnV0dG9uXCIpO1xyXG4gICAgdGhpcy5fY2FyZEltYWdlRWwgPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xyXG4gICAgdGhpcy5fY2FyZFRpdGxlRWwgPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xyXG5cclxuICAgIC8vIFNldCB0aGUgY2FyZCdzIHRpdGxlLCBpbWFnZSBzb3VyY2UsIGFuZCBhbHQgdGV4dFxyXG4gICAgdGhpcy5fY2FyZFRpdGxlRWwudGV4dENvbnRlbnQgPSB0aGlzLl9uYW1lO1xyXG4gICAgdGhpcy5fY2FyZEltYWdlRWwuc3JjID0gdGhpcy5fbGluaztcclxuICAgIHRoaXMuX2NhcmRJbWFnZUVsLmFsdCA9IHRoaXMuX25hbWU7XHJcblxyXG4gICAgLy8gU2V0IHRoZSBpbml0aWFsIGxpa2Ugc3RhdGUgKGFjdGl2ZS9pbmFjdGl2ZSlcclxuICAgIHRoaXMuc2V0TGlrZVN0YXRlKCk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX2NhcmRFbGVtZW50OyAvLyBSZXR1cm4gdGhlIGNvbnN0cnVjdGVkIGNhcmQgZWxlbWVudFxyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcclxuICAvLyBDb25zdHJ1Y3RvciBpbml0aWFsaXplcyB0aGUgY2xhc3Mgd2l0aCB2YWxpZGF0aW9uIHNldHRpbmdzIGFuZCB0aGUgZm9ybSBlbGVtZW50IHRvIGJlIHZhbGlkYXRlZFxyXG4gIGNvbnN0cnVjdG9yKHNldHRpbmdzLCBmb3JtRWxlbWVudCkge1xyXG4gICAgdGhpcy5fc2V0dGluZ3MgPSBzZXR0aW5nczsgLy8gT2JqZWN0IGNvbnRhaW5pbmcgdmFsaWRhdGlvbiBzZXR0aW5ncyAoc2VsZWN0b3JzLCBjbGFzc2VzKVxyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQgPSBmb3JtRWxlbWVudDsgLy8gVGhlIGZvcm0gZWxlbWVudCB0aGF0IHdpbGwgYmUgdmFsaWRhdGVkXHJcblxyXG4gICAgLy8gQ3JlYXRlIGFuIGFycmF5IG9mIGFsbCBpbnB1dCBlbGVtZW50cyBpbnNpZGUgdGhlIGZvcm1cclxuICAgIHRoaXMuX2lucHV0TGlzdCA9IEFycmF5LmZyb20oXHJcbiAgICAgIHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5fc2V0dGluZ3MuaW5wdXRTZWxlY3RvcilcclxuICAgICk7XHJcblxyXG4gICAgLy8gU2VsZWN0IHRoZSBzdWJtaXQgYnV0dG9uIGluc2lkZSB0aGUgZm9ybVxyXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgdGhpcy5fc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3JcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvLyBQcml2YXRlIG1ldGhvZCB0byBjaGVjayBpZiBhbnkgaW5wdXQgZmllbGQgaXMgaW52YWxpZFxyXG4gIF9oYXNJbnZhbGlkSW5wdXQoKSB7XHJcbiAgICAvLyBDaGVjayBpZiBhbnkgaW5wdXQgZmllbGQgaW4gdGhlIGZvcm0gaXMgaW52YWxpZFxyXG4gICAgcmV0dXJuIHRoaXMuX2lucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+ICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHJpdmF0ZSBtZXRob2QgdG8gZW5hYmxlIG9yIGRpc2FibGUgdGhlIHN1Ym1pdCBidXR0b24gYmFzZWQgb24gZm9ybSB2YWxpZGl0eVxyXG4gIF90b2dnbGVCdXR0b25TdGF0ZSgpIHtcclxuICAgIC8vIElmIHRoZXJlJ3MgYW55IGludmFsaWQgaW5wdXQsIGRpc2FibGUgdGhlIHN1Ym1pdCBidXR0b247IG90aGVyd2lzZSwgZW5hYmxlIGl0XHJcbiAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KCkpIHtcclxuICAgICAgdGhpcy5kaXNhYmxlQnV0dG9uKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBQcml2YXRlIG1ldGhvZCB0byBjaGVjayB0aGUgdmFsaWRpdHkgb2YgYSBzcGVjaWZpYyBpbnB1dCBlbGVtZW50IGFuZCBzaG93L2hpZGUgZXJyb3IgbWVzc2FnZXNcclxuICBfY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCkge1xyXG4gICAgLy8gRmluZCB0aGUgY29ycmVzcG9uZGluZyBlcnJvciBtZXNzYWdlIGVsZW1lbnQgZm9yIHRoZSBpbnB1dCBmaWVsZFxyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXHJcbiAgICApO1xyXG5cclxuICAgIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XHJcbiAgICAgIC8vIEFkZCB0aGUgZXJyb3IgY2xhc3MgYW5kIHNob3cgdGhlIHZhbGlkYXRpb24gbWVzc2FnZSBpZiB0aGUgaW5wdXQgaXMgaW52YWxpZFxyXG4gICAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2U7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBSZW1vdmUgdGhlIGVycm9yIGNsYXNzIGFuZCBjbGVhciB0aGUgZXJyb3IgbWVzc2FnZSBpZiB0aGUgaW5wdXQgaXMgdmFsaWRcclxuICAgICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzKTtcclxuICAgICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIFByaXZhdGUgbWV0aG9kIHRvIHNldCB1cCBldmVudCBsaXN0ZW5lcnMgZm9yIGlucHV0IGZpZWxkc1xyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIC8vIENoZWNrIHRoZSBidXR0b24gc3RhdGUgaW5pdGlhbGx5IGluIGNhc2Ugc29tZSBmaWVsZHMgYXJlIGFscmVhZHkgZmlsbGVkXHJcbiAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG5cclxuICAgIC8vIEFkZCBldmVudCBsaXN0ZW5lcnMgdG8gYWxsIGlucHV0IGZpZWxkcyBpbiB0aGUgZm9ybVxyXG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcclxuICAgICAgICAvLyBDaGVjayB0aGUgdmFsaWRpdHkgb2YgdGhlIGlucHV0IGZpZWxkIGluIHJlYWwtdGltZSBhbmQgdXBkYXRlIHRoZSBidXR0b24gc3RhdGVcclxuICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbGVtZW50KTtcclxuICAgICAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljIG1ldGhvZCB0byBlbmFibGUgdmFsaWRhdGlvbiAoc2V0cyB1cCB0aGUgZXZlbnQgbGlzdGVuZXJzIGZvciB0aGUgZm9ybSlcclxuICBlbmFibGVWYWxpZGF0aW9uKCkge1xyXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICB9XHJcblxyXG4gIC8vIFB1YmxpYyBtZXRob2QgdG8gcmVzZXQgZm9ybSB2YWxpZGF0aW9uIChjbGVhciBlcnJvcnMgYW5kIHJlc2V0IGJ1dHRvbiBzdGF0ZSlcclxuICByZXNldFZhbGlkYXRpb24oKSB7XHJcbiAgICAvLyBMb29wIHRocm91Z2ggYWxsIGlucHV0IGZpZWxkcyBpbiB0aGUgZm9ybVxyXG4gICAgdGhpcy5faW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgIGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxyXG4gICAgICApO1xyXG4gICAgICAvLyBSZW1vdmUgYW55IGVycm9yIGNsYXNzZXMgYW5kIGNsZWFyIGVycm9yIG1lc3NhZ2VzXHJcbiAgICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NldHRpbmdzLmlucHV0RXJyb3JDbGFzcyk7XHJcbiAgICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBSZXNldCB0aGUgc3VibWl0IGJ1dHRvbidzIHN0YXRlXHJcbiAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xyXG4gIH1cclxuXHJcbiAgLy8gUHVibGljIG1ldGhvZCB0byBkaXNhYmxlIHRoZSBzdWJtaXQgYnV0dG9uXHJcbiAgZGlzYWJsZUJ1dHRvbigpIHtcclxuICAgIC8vIEFkZCBhIGNsYXNzIHRvIGRpc2FibGUgdGhlIGJ1dHRvbiBhbmQgc2V0IHRoZSBkaXNhYmxlZCBhdHRyaWJ1dGUgdG8gdHJ1ZVxyXG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xyXG4gIH1cclxufVxyXG4iLCIvLyBUaGlzIGNsYXNzIGhhbmRsZXMgdGhlIGJhc2ljIGZ1bmN0aW9uYWxpdHkgZm9yIG9wZW5pbmcgYW5kIGNsb3NpbmcgcG9wdXBzLlxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xyXG4gICAgLy8gU2VsZWN0IHRoZSBwb3B1cCBlbGVtZW50IHVzaW5nIHRoZSBwcm92aWRlZCBzZWxlY3Rvci5cclxuICAgIHRoaXMuX3BvcHVwRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3Rvcik7XHJcblxyXG4gICAgLy8gQmluZCB0aGUgY29udGV4dCBvZiB0aGUgX2hhbmRsZUVzY0Nsb3NlIG1ldGhvZCB0byB0aGlzIGluc3RhbmNlXHJcbiAgICAvLyBUaGlzIGVuc3VyZXMgdGhhdCB0aGUgJ3RoaXMnIGtleXdvcmQgaW5zaWRlIF9oYW5kbGVFc2NDbG9zZSByZWZlcnMgdG8gdGhlIGNsYXNzIGluc3RhbmNlXHJcbiAgICB0aGlzLl9oYW5kbGVFc2NDbG9zZSA9IHRoaXMuX2hhbmRsZUVzY0Nsb3NlLmJpbmQodGhpcyk7XHJcbiAgfVxyXG5cclxuICAvLyBNZXRob2QgdG8gb3BlbiB0aGUgcG9wdXAgYW5kIGFkZCBhbiBldmVudCBsaXN0ZW5lciB0byBkZXRlY3QgdGhlIFwiRXNjYXBlXCIga2V5IHByZXNzXHJcbiAgb3BlbigpIHtcclxuICAgIC8vIEFkZCBhIGNsYXNzIHRvIG9wZW4gdGhlIHBvcHVwXHJcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInBvcHVwX29wZW5lZFwiKTtcclxuXHJcbiAgICAvLyBBdHRhY2ggYW4gZXZlbnQgbGlzdGVuZXIgdG8gdGhlIGRvY3VtZW50IHRvIGRldGVjdCB0aGUgXCJFc2NhcGVcIiBrZXkgcHJlc3MgYW5kIGNsb3NlIHRoZSBwb3B1cFxyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xyXG4gIH1cclxuXHJcbiAgLy8gTWV0aG9kIHRvIGNsb3NlIHRoZSBwb3B1cCBhbmQgcmVtb3ZlIHRoZSBcIkVzY2FwZVwiIGtleSBldmVudCBsaXN0ZW5lclxyXG4gIGNsb3NlKCkge1xyXG4gICAgLy8gUmVtb3ZlIHRoZSBjbGFzcyB0aGF0IG9wZW5zIHRoZSBwb3B1cFxyXG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9vcGVuZWRcIik7XHJcblxyXG4gICAgLy8gUmVtb3ZlIHRoZSBcImtleWRvd25cIiBldmVudCBsaXN0ZW5lciB3aGVuIHRoZSBwb3B1cCBpcyBjbG9zZWRcclxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcclxuICB9XHJcblxyXG4gIC8vIFByaXZhdGUgbWV0aG9kIHRvIGhhbmRsZSBjbG9zaW5nIHRoZSBwb3B1cCB3aGVuIHRoZSBcIkVzY2FwZVwiIGtleSBpcyBwcmVzc2VkXHJcbiAgX2hhbmRsZUVzY0Nsb3NlKGV2dCkge1xyXG4gICAgLy8gSWYgdGhlIFwiRXNjYXBlXCIga2V5IGlzIHByZXNzZWQsIGNsb3NlIHRoZSBwb3B1cFxyXG4gICAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcclxuICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gTWV0aG9kIHRvIHNldCB1cCBldmVudCBsaXN0ZW5lcnMgZm9yIHRoZSBwb3B1cCAoY2xvc2UgYnV0dG9uIGFuZCBiYWNrZ3JvdW5kIGNsaWNrKVxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgLy8gRmluZCBhbmQgYXR0YWNoIGFuIGV2ZW50IGxpc3RlbmVyIHRvIHRoZSBjbG9zZSBidXR0b24gb2YgdGhlIHBvcHVwXHJcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnRcclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2Nsb3NlXCIpXHJcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuY2xvc2UoKTsgLy8gQ2xvc2UgdGhlIHBvcHVwIHdoZW4gdGhlIGNsb3NlIGJ1dHRvbiBpcyBjbGlja2VkXHJcbiAgICAgIH0pO1xyXG5cclxuICAgIC8vIEFkZCBhbiBldmVudCBsaXN0ZW5lciB0byB0aGUgcG9wdXAgdG8gY2xvc2UgaXQgd2hlbiBjbGlja2luZyBvbiB0aGUgYmFja2dyb3VuZCAob3V0c2lkZSB0aGUgcG9wdXAgY29udGVudClcclxuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChldnQpID0+IHtcclxuICAgICAgLy8gSWYgdGhlIHVzZXIgY2xpY2tzIGRpcmVjdGx5IG9uIHRoZSBwb3B1cCBiYWNrZ3JvdW5kLCBjbG9zZSB0aGUgcG9wdXBcclxuICAgICAgaWYgKGV2dC50YXJnZXQgPT09IHRoaXMuX3BvcHVwRWxlbWVudCkge1xyXG4gICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiIsIi8vIEltcG9ydCB0aGUgYmFzZSBQb3B1cCBjbGFzc1xyXG5pbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcclxuXHJcbi8vIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB0byBoYW5kbGUgZm9ybXMgaW5zaWRlIGEgcG9wdXBcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcclxuICAvLyBDb25zdHJ1Y3RvciB0YWtlcyB0aGUgcG9wdXAgc2VsZWN0b3IgYW5kIGEgZnVuY3Rpb24gdG8gaGFuZGxlIGZvcm0gc3VibWlzc2lvblxyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXQpIHtcclxuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDtcclxuXHJcbiAgICAvLyBDaGVjayBpZiB0aGVyZSdzIGEgZm9ybSBlbGVtZW50LCBhcyBzb21lIHBvcHVwcyBtaWdodCBub3QgaGF2ZSBvbmVcclxuICAgIHRoaXMuZm9ybUVsZW1lbnQgPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fZm9ybVwiKSB8fCBudWxsO1xyXG5cclxuICAgIC8vIEZpbmQgdGhlIHN1Ym1pdCBidXR0b24gYW5kIHN0b3JlIGl0cyBpbml0aWFsIHRleHRcclxuICAgIGlmICh0aGlzLmZvcm1FbGVtZW50KSB7XHJcbiAgICAgIHRoaXMuX3N1Ym1pdEJ0biA9IHRoaXMuZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fYnV0dG9uXCIpO1xyXG4gICAgICB0aGlzLl9zdWJtaXRCdG5UZXh0ID0gdGhpcy5fc3VibWl0QnRuLnRleHRDb250ZW50OyAvLyBTdG9yZSBpbml0aWFsIGJ1dHRvbiB0ZXh0XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSWYgYSBmb3JtIGV4aXN0cywgZ2V0IGlucHV0IGZpZWxkc1xyXG4gICAgaWYgKHRoaXMuZm9ybUVsZW1lbnQpIHtcclxuICAgICAgdGhpcy5pbnB1dExpc3QgPSBBcnJheS5mcm9tKFxyXG4gICAgICAgIHRoaXMuZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5wb3B1cF9faW5wdXRcIilcclxuICAgICAgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIE1ldGhvZCB0byBnZXQgaW5wdXQgdmFsdWVzIGZyb20gdGhlIGZvcm1cclxuICBfX2dldElucHV0VmFsdWVzKCkge1xyXG4gICAgY29uc3QgaW5wdXRWYWx1ZXMgPSB7fTtcclxuICAgIGlmICh0aGlzLmZvcm1FbGVtZW50KSB7XHJcbiAgICAgIHRoaXMuaW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XHJcbiAgICAgICAgaW5wdXRWYWx1ZXNbaW5wdXQubmFtZV0gPSBpbnB1dC52YWx1ZTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaW5wdXRWYWx1ZXM7XHJcbiAgfVxyXG5cclxuICAvLyBNZXRob2QgdG8gaGFuZGxlIHRoZSBsb2FkaW5nIHN0YXRlIG9mIHRoZSBzdWJtaXQgYnV0dG9uXHJcbiAgcmVuZGVyTG9hZGluZyhpc0xvYWRpbmcsIGxvYWRpbmdUZXh0ID0gXCJTYXZpbmcuLi5cIikge1xyXG4gICAgaWYgKGlzTG9hZGluZykge1xyXG4gICAgICB0aGlzLl9zdWJtaXRCdG4udGV4dENvbnRlbnQgPSBsb2FkaW5nVGV4dDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX3N1Ym1pdEJ0bi50ZXh0Q29udGVudCA9IHRoaXMuX3N1Ym1pdEJ0blRleHQ7IC8vIFJldmVydCB0byBpbml0aWFsIHRleHRcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIEFkZCBldmVudCBsaXN0ZW5lcnMgdG8gdGhlIGZvcm1cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG4gICAgaWYgKHRoaXMuZm9ybUVsZW1lbnQpIHtcclxuICAgICAgdGhpcy5mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcclxuICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB0aGlzLmhhbmRsZUZvcm1TdWJtaXQodGhpcy5fX2dldElucHV0VmFsdWVzKCkpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIE1ldGhvZCB0byByZXNldCB0aGUgZm9ybVxyXG4gIHJlc2V0Rm9ybSgpIHtcclxuICAgIGlmICh0aGlzLmZvcm1FbGVtZW50KSB7XHJcbiAgICAgIHRoaXMuZm9ybUVsZW1lbnQucmVzZXQoKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIiwiLy8gSW1wb3J0c1xyXG5pbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiO1xyXG5pbXBvcnQgeyBmb3JtVmFsaWRhdGlvblNldHRpbmdzLCBzZWxlY3RvcnMgfSBmcm9tIFwiLi4vdXRpbHMvdXRpbHMuanNcIjtcclxuaW1wb3J0IENhcmQgZnJvbSBcIi4uL2NvbXBvbmVudHMvQ2FyZC5qc1wiO1xyXG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcclxuaW1wb3J0IFBvcHVwV2l0aEltYWdlIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XHJcbmltcG9ydCBQb3B1cFdpdGhDb25maXJtYXRpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoQ29uZmlybWF0aW9uLmpzXCI7XHJcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcclxuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XHJcbmltcG9ydCBcIi4uL3BhZ2VzL2luZGV4LmNzc1wiO1xyXG5cclxuLy8gSW5pdGlhbGl6ZSB0aGUgQVBJIGluc3RhbmNlXHJcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xyXG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiBcIjc2NWE1NmFiLTE0MDMtNDQ0NC04ZmFjLTVmYzE4NzFlOTY5NVwiLFxyXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgfSxcclxufSk7XHJcblxyXG4vLyBEZXN0cnVjdHVyZWQgc2VsZWN0b3JzIGZyb20gdXRpbHNcclxuY29uc3Qge1xyXG4gIGFkZENhcmRGb3JtLFxyXG4gIGFkZENhcmRCdXR0b24sXHJcbiAgYXZhdGFyRWRpdEZvcm0sXHJcbiAgcHJvZmlsZUVkaXRGb3JtLFxyXG4gIHByb2ZpbGVFZGl0QnV0dG9uLFxyXG4gIHByb2ZpbGVUaXRsZUlucHV0LFxyXG4gIHByb2ZpbGVEZXNjcmlwdGlvbklucHV0LFxyXG59ID0gc2VsZWN0b3JzO1xyXG5cclxuLy8gQ2FjaGUgRE9NIGVsZW1lbnQgZm9yIHRoZSBhdmF0YXIgZWRpdCBidXR0b24gdG8gYXZvaWQgcXVlcnlpbmcgdGhlIERPTSByZXBlYXRlZGx5XHJcbmNvbnN0IGF2YXRhckVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtYXZhdGFyLWJ1dHRvblwiKTtcclxuXHJcbi8vIEluaXRpYWxpemUgVXNlckluZm8gdG8gbWFuYWdlIGFuZCB1cGRhdGUgcHJvZmlsZSBkYXRhIG9uIHRoZSBwYWdlXHJcbmNvbnN0IHVzZXJJbmZvSW5zdGFuY2UgPSBuZXcgVXNlckluZm8oe1xyXG4gIG5hbWVTZWxlY3RvcjogXCIucHJvZmlsZV9fdGl0bGVcIixcclxuICBkZXNjcmlwdGlvblNlbGVjdG9yOiBcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiLFxyXG4gIGF2YXRhclNlbGVjdG9yOiBcIi5wcm9maWxlX19pbWFnZVwiLFxyXG59KTtcclxuXHJcbi8vIEluaXRpYWxpemUgdGhlIGRlbGV0ZSBjb25maXJtYXRpb24gcG9wdXAgb25seSBvbmNlXHJcbmNvbnN0IGRlbGV0ZVBvcHVwSW5zdGFuY2UgPSBuZXcgUG9wdXBXaXRoQ29uZmlybWF0aW9uKFwiI2RlbGV0ZS1jYXJkLXBvcHVwXCIpO1xyXG5kZWxldGVQb3B1cEluc3RhbmNlLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG4vLyBGdW5jdGlvbiB0byBoYW5kbGUgY2FyZCBkZWxldGlvbiB3aXRoIGNvbmZpcm1hdGlvbiBwb3B1cFxyXG5jb25zdCBoYW5kbGVEZWxldGVDYXJkID0gKGNhcmRFbGVtZW50LCBjYXJkSWQpID0+IHtcclxuICBkZWxldGVQb3B1cEluc3RhbmNlLnNldENvbmZpcm1IYW5kbGVyKCgpID0+IHtcclxuICAgIGFwaVxyXG4gICAgICAuZGVsZXRlQ2FyZChjYXJkSWQpXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICBjYXJkRWxlbWVudC5yZW1vdmUoKTtcclxuICAgICAgICBkZWxldGVQb3B1cEluc3RhbmNlLmNsb3NlKCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGBFcnJvciBkZWxldGluZyBjYXJkOiAke2Vycn1gKSk7XHJcbiAgfSk7XHJcbiAgZGVsZXRlUG9wdXBJbnN0YW5jZS5vcGVuKCk7XHJcbn07XHJcblxyXG4vLyBGdW5jdGlvbiB0byBjcmVhdGUgYSBjYXJkXHJcbmNvbnN0IGNyZWF0ZUNhcmQgPSAoY2FyZERhdGEpID0+IHtcclxuICBjb25zdCBjYXJkID0gbmV3IENhcmQoXHJcbiAgICB7XHJcbiAgICAgIG5hbWU6IGNhcmREYXRhLm5hbWUsXHJcbiAgICAgIGxpbms6IGNhcmREYXRhLmxpbmssXHJcbiAgICAgIF9pZDogY2FyZERhdGEuX2lkLFxyXG4gICAgICBvd25lcjogY2FyZERhdGEub3duZXIsXHJcbiAgICAgIGlzTGlrZWQ6IGNhcmREYXRhLmlzTGlrZWQsXHJcbiAgICB9LFxyXG4gICAgXCIjY2FyZC10ZW1wbGF0ZVwiLFxyXG4gICAgaGFuZGxlSW1hZ2VQb3B1cCxcclxuICAgIGN1cnJlbnRVc2VySWQsXHJcbiAgICBhcGksXHJcbiAgICBoYW5kbGVEZWxldGVDYXJkXHJcbiAgKTtcclxuICByZXR1cm4gY2FyZC5nZXRWaWV3KCk7XHJcbn07XHJcblxyXG4vLyBJbml0aWFsaXplIHRoZSBTZWN0aW9uIGNsYXNzIHRvIHJlbmRlciBhbmQgbWFuYWdlIHRoZSBjYXJkIGxpc3QgaW4gdGhlIFVJXHJcbmNvbnN0IGNhcmRTZWN0aW9uID0gbmV3IFNlY3Rpb24oXHJcbiAge1xyXG4gICAgcmVuZGVyZXI6IChjYXJkRGF0YSkgPT4ge1xyXG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGNyZWF0ZUNhcmQoY2FyZERhdGEpO1xyXG4gICAgICBjYXJkU2VjdGlvbi5hZGRJdGVtKGNhcmRFbGVtZW50KTtcclxuICAgIH0sXHJcbiAgfSxcclxuICBcIi5jYXJkc19fbGlzdFwiXHJcbik7XHJcblxyXG4vLyBGZXRjaCBhbmQgcmVuZGVyIHVzZXIgaW5mbyBhbmQgY2FyZHMgYWZ0ZXIgcGFnZSBsb2FkXHJcbmxldCBjdXJyZW50VXNlcklkOyAvLyBWYXJpYWJsZSB0byBzdG9yZSB0aGUgY3VycmVudCB1c2VyJ3MgSURcclxuYXBpXHJcbiAgLmdldFVzZXJJbmZvKClcclxuICAudGhlbigodXNlckluZm8pID0+IHtcclxuICAgIHVzZXJJbmZvSW5zdGFuY2Uuc2V0VXNlckluZm8oe1xyXG4gICAgICBuYW1lOiB1c2VySW5mby5uYW1lLFxyXG4gICAgICBkZXNjcmlwdGlvbjogdXNlckluZm8uYWJvdXQsXHJcbiAgICAgIGF2YXRhcjogdXNlckluZm8uYXZhdGFyLFxyXG4gICAgfSk7XHJcbiAgICBjdXJyZW50VXNlcklkID0gdXNlckluZm8uX2lkO1xyXG5cclxuICAgIHJldHVybiBhcGkuZ2V0SW5pdGlhbENhcmRzKCk7XHJcbiAgfSlcclxuICAudGhlbigoY2FyZHMpID0+IHtcclxuICAgIGNhcmRTZWN0aW9uLnJlbmRlckl0ZW1zKGNhcmRzLnJldmVyc2UoKSk7XHJcbiAgfSlcclxuXHJcbiAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyB1c2VyIGluZm8gb3IgY2FyZHM6XCIsIGVycikpO1xyXG5cclxuLy8gT3BlbnMgcHJvZmlsZSBlZGl0IHBvcHVwIGFuZCBwcmUtZmlsbHMgdGhlIGZvcm0gd2l0aCBjdXJyZW50IHVzZXIgaW5mb1xyXG5jb25zdCBoYW5kbGVQcm9maWxlRWRpdCA9ICgpID0+IHtcclxuICBjb25zdCB1c2VyRGF0YSA9IHVzZXJJbmZvSW5zdGFuY2UuZ2V0VXNlckluZm8oKTsgLy8gR2V0IGN1cnJlbnQgcHJvZmlsZSBkYXRhXHJcbiAgcHJvZmlsZVRpdGxlSW5wdXQudmFsdWUgPSB1c2VyRGF0YS5uYW1lOyAvLyBQcmUtZmlsbCBwcm9maWxlIG5hbWUgaW5wdXRcclxuICBwcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IHVzZXJEYXRhLmRlc2NyaXB0aW9uOyAvLyBQcmUtZmlsbCBwcm9maWxlIGRlc2NyaXB0aW9uXHJcbiAgcHJvZmlsZUZvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7IC8vIFJlc2V0IGZvcm0gdmFsaWRhdGlvbiBzdGF0ZVxyXG4gIHByb2ZpbGVFZGl0UG9wdXBJbnN0YW5jZS5vcGVuKCk7IC8vIE9wZW4gdGhlIHByb2ZpbGUgZWRpdCBwb3B1cFxyXG59O1xyXG5cclxuLy8gT3BlbnMgdGhlIGltYWdlIHBvcHVwIHdoZW4gYSBjYXJkIGltYWdlIGlzIGNsaWNrZWRcclxuY29uc3QgaGFuZGxlSW1hZ2VQb3B1cCA9IChsaW5rLCBuYW1lKSA9PiB7XHJcbiAgcGljdHVyZVBvcHVwSW5zdGFuY2Uub3Blbih7IG5hbWUsIGxpbmsgfSk7XHJcbn07XHJcblxyXG4vLyBJbml0aWFsaXplIHByb2ZpbGUgZWRpdCBwb3B1cCB3aXRoIGZvcm0gc3VibWlzc2lvbiBoYW5kbGluZ1xyXG5jb25zdCBwcm9maWxlRWRpdFBvcHVwSW5zdGFuY2UgPSBuZXcgUG9wdXBXaXRoRm9ybShcclxuICBcIiNwcm9maWxlLWVkaXQtcG9wdXBcIixcclxuICAoZm9ybURhdGEpID0+IHtcclxuICAgIHByb2ZpbGVFZGl0UG9wdXBJbnN0YW5jZS5yZW5kZXJMb2FkaW5nKHRydWUpO1xyXG5cclxuICAgIC8vIFNlbmQgUEFUQ0ggcmVxdWVzdCB0byB1cGRhdGUgdGhlIHVzZXIncyBwcm9maWxlIGluZm9cclxuICAgIGFwaVxyXG4gICAgICAudXBkYXRlVXNlckluZm8oe1xyXG4gICAgICAgIG5hbWU6IGZvcm1EYXRhLm5hbWUsXHJcbiAgICAgICAgYWJvdXQ6IGZvcm1EYXRhLmRlc2NyaXB0aW9uLFxyXG4gICAgICB9KVxyXG4gICAgICAudGhlbigodXBkYXRlZFVzZXJJbmZvKSA9PiB7XHJcbiAgICAgICAgdXNlckluZm9JbnN0YW5jZS5zZXRVc2VySW5mbyh7XHJcbiAgICAgICAgICBuYW1lOiB1cGRhdGVkVXNlckluZm8ubmFtZSxcclxuICAgICAgICAgIGRlc2NyaXB0aW9uOiB1cGRhdGVkVXNlckluZm8uYWJvdXQsXHJcbiAgICAgICAgICBhdmF0YXI6IHVwZGF0ZWRVc2VySW5mby5hdmF0YXIsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcHJvZmlsZUVkaXRQb3B1cEluc3RhbmNlLmNsb3NlKCk7XHJcbiAgICAgICAgcHJvZmlsZUVkaXRQb3B1cEluc3RhbmNlLnJlc2V0Rm9ybSgpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1cGRhdGluZyBwcm9maWxlOlwiLCBlcnIpO1xyXG4gICAgICB9KVxyXG4gICAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgcHJvZmlsZUVkaXRQb3B1cEluc3RhbmNlLnJlbmRlckxvYWRpbmcoZmFsc2UpO1xyXG4gICAgICB9KTtcclxuICB9XHJcbik7XHJcblxyXG5wcm9maWxlRWRpdFBvcHVwSW5zdGFuY2Uuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbi8vIEluaXRpYWxpemUgdGhlIGNhcmQgYWRkaXRpb24gcG9wdXAgd2l0aCBmb3JtIHN1Ym1pc3Npb24gaGFuZGxpbmdcclxuY29uc3QgYWRkQ2FyZFBvcHVwSW5zdGFuY2UgPSBuZXcgUG9wdXBXaXRoRm9ybShcclxuICBcIiNhZGQtY2FyZC1wb3B1cFwiLFxyXG4gIChmb3JtRGF0YSkgPT4ge1xyXG4gICAgYWRkQ2FyZFBvcHVwSW5zdGFuY2UucmVuZGVyTG9hZGluZyh0cnVlKTtcclxuICAgIC8vIFNlbmQgUE9TVCByZXF1ZXN0IHRvIGFkZCBhIG5ldyBjYXJkXHJcbiAgICBhcGlcclxuICAgICAgLmFkZENhcmQoe1xyXG4gICAgICAgIG5hbWU6IGZvcm1EYXRhLnRpdGxlLFxyXG4gICAgICAgIGxpbms6IGZvcm1EYXRhLnVybCxcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oKG5ld0NhcmQpID0+IHtcclxuICAgICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGNyZWF0ZUNhcmQoe1xyXG4gICAgICAgICAgbmFtZTogbmV3Q2FyZC5uYW1lLFxyXG4gICAgICAgICAgbGluazogbmV3Q2FyZC5saW5rLFxyXG4gICAgICAgICAgX2lkOiBuZXdDYXJkLl9pZCxcclxuICAgICAgICAgIG93bmVyOiBuZXdDYXJkLm93bmVyLFxyXG4gICAgICAgICAgbGlrZXM6IG5ld0NhcmQubGlrZXMsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY2FyZFNlY3Rpb24uYWRkSXRlbShjYXJkRWxlbWVudCk7XHJcbiAgICAgICAgYWRkQ2FyZFBvcHVwSW5zdGFuY2UuY2xvc2UoKTtcclxuICAgICAgICBhZGRDYXJkUG9wdXBJbnN0YW5jZS5yZXNldEZvcm0oKTtcclxuICAgICAgICBjYXJkRm9ybVZhbGlkYXRvci5kaXNhYmxlQnV0dG9uKCk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGFkZGluZyBjYXJkOlwiLCBlcnIpO1xyXG4gICAgICB9KVxyXG4gICAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgYWRkQ2FyZFBvcHVwSW5zdGFuY2UucmVuZGVyTG9hZGluZyhmYWxzZSk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuKTtcclxuXHJcbmFkZENhcmRQb3B1cEluc3RhbmNlLnNldEV2ZW50TGlzdGVuZXJzKCk7IC8vIFNldCBldmVudCBsaXN0ZW5lcnMgZm9yIHRoZSBjYXJkIGFkZGl0aW9uIHBvcHVwXHJcblxyXG4vLyBJbml0aWFsaXplIGF2YXRhciBlZGl0IHBvcHVwIHdpdGggZm9ybSBzdWJtaXNzaW9uIGhhbmRsaW5nXHJcbmNvbnN0IGF2YXRhckVkaXRQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKFwiI2F2YXRhci1lZGl0LXBvcHVwXCIsIChmb3JtRGF0YSkgPT4ge1xyXG4gIGF2YXRhckVkaXRQb3B1cC5yZW5kZXJMb2FkaW5nKHRydWUpO1xyXG5cclxuICBhcGlcclxuICAgIC51cGRhdGVBdmF0YXIoZm9ybURhdGEuYXZhdGFyKVxyXG4gICAgLnRoZW4oKHVwZGF0ZWRVc2VySW5mbykgPT4ge1xyXG4gICAgICB1c2VySW5mb0luc3RhbmNlLnNldFVzZXJJbmZvKHtcclxuICAgICAgICBuYW1lOiB1cGRhdGVkVXNlckluZm8ubmFtZSxcclxuICAgICAgICBkZXNjcmlwdGlvbjogdXBkYXRlZFVzZXJJbmZvLmFib3V0LFxyXG4gICAgICAgIGF2YXRhcjogdXBkYXRlZFVzZXJJbmZvLmF2YXRhcixcclxuICAgICAgfSk7XHJcbiAgICAgIGF2YXRhckVkaXRQb3B1cC5jbG9zZSgpO1xyXG4gICAgICBhdmF0YXJFZGl0Rm9ybS5yZXNldCgpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKFwiRXJyb3IgdXBkYXRpbmcgYXZhdGFyOlwiLCBlcnIpKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBhdmF0YXJFZGl0UG9wdXAucmVuZGVyTG9hZGluZyhmYWxzZSk7XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG5hdmF0YXJFZGl0UG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbi8vIFNldCB1cCB0aGUgZXZlbnQgbGlzdGVuZXIgZm9yIHRoZSBhdmF0YXIgZWRpdCBidXR0b25cclxuYXZhdGFyRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGF2YXRhckZvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7XHJcbiAgYXZhdGFyRWRpdFBvcHVwLm9wZW4oKTtcclxufSk7XHJcblxyXG4vLyBJbml0aWFsaXplIGltYWdlIHBvcHVwIGZvciBkaXNwbGF5aW5nIGxhcmdlciBpbWFnZXNcclxuY29uc3QgcGljdHVyZVBvcHVwSW5zdGFuY2UgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoXCIjcGljdHVyZS1wb3B1cFwiKTtcclxucGljdHVyZVBvcHVwSW5zdGFuY2Uuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbi8vIEluaXRpYWxpemUgZm9ybSB2YWxpZGF0b3JzIGZvciBwcm9maWxlLCBjYXJkLCBhbmQgYXZhdGFyIGZvcm1zXHJcbmNvbnN0IHByb2ZpbGVGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoXHJcbiAgZm9ybVZhbGlkYXRpb25TZXR0aW5ncyxcclxuICBwcm9maWxlRWRpdEZvcm1cclxuKTtcclxuY29uc3QgY2FyZEZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihcclxuICBmb3JtVmFsaWRhdGlvblNldHRpbmdzLFxyXG4gIGFkZENhcmRGb3JtXHJcbik7XHJcbmNvbnN0IGF2YXRhckZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihcclxuICBmb3JtVmFsaWRhdGlvblNldHRpbmdzLFxyXG4gIGF2YXRhckVkaXRGb3JtXHJcbik7XHJcblxyXG4vLyBFbmFibGUgZm9ybSB2YWxpZGF0aW9uIGZvciBhbGwgZm9ybXNcclxucHJvZmlsZUZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG5jYXJkRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbmF2YXRhckZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG5cclxuLy8gU2V0IHVwIGV2ZW50IGxpc3RlbmVycyBmb3IgcHJvZmlsZSBlZGl0IGFuZCBhZGQgY2FyZCBidXR0b25zXHJcbnByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVQcm9maWxlRWRpdCk7XHJcbmFkZENhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBhZGRDYXJkUG9wdXBJbnN0YW5jZS5vcGVuKCk7XHJcbn0pO1xyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xyXG4gIC8vIENvbnN0cnVjdG9yIGluaXRpYWxpemVzIEFQSSB3aXRoIGEgYmFzZSBVUkwgYW5kIGF1dGhvcml6YXRpb24gaGVhZGVyc1xyXG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XHJcbiAgICB0aGlzLmJhc2VVcmwgPSBiYXNlVXJsO1xyXG4gICAgdGhpcy5oZWFkZXJzID0gaGVhZGVycztcclxuICB9XHJcblxyXG4gIC8vIEdlbmVyYWwgbWV0aG9kIHRvIGhhbmRsZSBmZXRjaCByZXF1ZXN0cyBhbmQgY2hlY2sgcmVzcG9uc2VzXHJcbiAgX3JlcXVlc3QodXJsLCBvcHRpb25zKSB7XHJcbiAgICByZXR1cm4gZmV0Y2godXJsLCBvcHRpb25zKS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xyXG4gIH1cclxuXHJcbiAgLy8gTWV0aG9kIHRvIGNoZWNrIHRoZSBzZXJ2ZXIncyByZXNwb25zZSBhbmQgaGFuZGxlIGVycm9yc1xyXG4gIF9jaGVja1Jlc3BvbnNlKHJlcykge1xyXG4gICAgaWYgKHJlcy5vaykge1xyXG4gICAgICByZXR1cm4gcmVzLmpzb24oKTsgLy8gUmV0dXJuIEpTT04gaWYgcmVzcG9uc2UgaXMgT0tcclxuICAgIH1cclxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTsgLy8gUmVqZWN0IHByb21pc2Ugd2l0aCBlcnJvciBzdGF0dXNcclxuICB9XHJcblxyXG4gIC8vIEdlbmVyYWwgZXJyb3IgaGFuZGxlciBmb3IgY2F0Y2hpbmcgYW5kIGxvZ2dpbmcgZXJyb3JzXHJcbiAgX2hhbmRsZUVycm9yKGVycikge1xyXG4gICAgY29uc29sZS5lcnJvcihlcnIpOyAvLyBMb2cgZXJyb3IgdG8gY29uc29sZVxyXG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycik7IC8vIFJlamVjdCB0aGUgcHJvbWlzZSB3aXRoIHRoZSBlcnJvclxyXG4gIH1cclxuXHJcbiAgLy8gRmV0Y2ggaW5pdGlhbCBzZXQgb2YgY2FyZHMgZnJvbSB0aGUgc2VydmVyXHJcbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLCAvLyBQYXNzIGF1dGhvcml6YXRpb24gaGVhZGVyc1xyXG4gICAgfSkuY2F0Y2godGhpcy5faGFuZGxlRXJyb3IpOyAvLyBIYW5kbGUgZXJyb3JzXHJcbiAgfVxyXG5cclxuICAvLyBGZXRjaCB1c2VyIGluZm9ybWF0aW9uIGZyb20gdGhlIHNlcnZlclxyXG4gIGdldFVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLCAvLyBBdXRob3JpemF0aW9uIGhlYWRlcnMgZm9yIHRoZSByZXF1ZXN0XHJcbiAgICB9KS5jYXRjaCh0aGlzLl9oYW5kbGVFcnJvcik7IC8vIEhhbmRsZSBlcnJvcnNcclxuICB9XHJcblxyXG4gIC8vIFVwZGF0ZSB1c2VyIGluZm9ybWF0aW9uIChuYW1lLCBhYm91dCkgb24gdGhlIHNlcnZlclxyXG4gIHVwZGF0ZVVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsIC8vIFBBVENIIHJlcXVlc3QgZm9yIHBhcnRpYWwgdXBkYXRlc1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBuYW1lOiBuYW1lLFxyXG4gICAgICAgIGFib3V0OiBhYm91dCxcclxuICAgICAgfSksIC8vIEpTT04gYm9keSB3aXRoIHVwZGF0ZWQgZGF0YVxyXG4gICAgfSkuY2F0Y2godGhpcy5faGFuZGxlRXJyb3IpOyAvLyBIYW5kbGUgZXJyb3JzXHJcbiAgfVxyXG5cclxuICAvLyBBZGQgYSBuZXcgY2FyZCAobmFtZSwgbGluaykgdG8gdGhlIHNlcnZlclxyXG4gIGFkZENhcmQoeyBuYW1lLCBsaW5rIH0pIHtcclxuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsIC8vIFBPU1QgcmVxdWVzdCB0byBjcmVhdGUgbmV3IGNhcmRcclxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZTogbmFtZSxcclxuICAgICAgICBsaW5rOiBsaW5rLFxyXG4gICAgICB9KSwgLy8gSlNPTiBib2R5IHdpdGggY2FyZCBkZXRhaWxzXHJcbiAgICB9KS5jYXRjaCh0aGlzLl9oYW5kbGVFcnJvcik7IC8vIEhhbmRsZSBlcnJvcnNcclxuICB9XHJcblxyXG4gIC8vIERlbGV0ZSBhIGNhcmQgYnkgaXRzIElEXHJcbiAgZGVsZXRlQ2FyZChjYXJkSWQpIHtcclxuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsIC8vIERFTEVURSByZXF1ZXN0IHRvIHJlbW92ZSB0aGUgY2FyZFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsIC8vIEF1dGhvcml6YXRpb24gaGVhZGVyc1xyXG4gICAgfSkuY2F0Y2godGhpcy5faGFuZGxlRXJyb3IpOyAvLyBIYW5kbGUgZXJyb3JzXHJcbiAgfVxyXG5cclxuICAvLyBMaWtlIGEgY2FyZCBieSBzZW5kaW5nIGEgUFVUIHJlcXVlc3QgdG8gdGhlIHNlcnZlclxyXG4gIGxpa2VDYXJkKGNhcmRJZCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH0vbGlrZXNgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQVVRcIiwgLy8gUFVUIHJlcXVlc3QgdG8gbGlrZSB0aGUgY2FyZFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXHJcbiAgICB9KS5jYXRjaCh0aGlzLl9oYW5kbGVFcnJvcik7IC8vIEhhbmRsZSBlcnJvcnNcclxuICB9XHJcblxyXG4gIC8vIERpc2xpa2UgYSBjYXJkIGJ5IHNlbmRpbmcgYSBERUxFVEUgcmVxdWVzdCB0byB0aGUgc2VydmVyXHJcbiAgZGlzbGlrZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgJHt0aGlzLmJhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcclxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLCAvLyBERUxFVEUgcmVxdWVzdCB0byByZW1vdmUgdGhlIGxpa2VcclxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxyXG4gICAgfSkuY2F0Y2godGhpcy5faGFuZGxlRXJyb3IpOyAvLyBIYW5kbGUgZXJyb3JzXHJcbiAgfVxyXG5cclxuICAvLyBVcGRhdGUgdXNlciBhdmF0YXIgYnkgc2VuZGluZyBhIFBBVENIIHJlcXVlc3Qgd2l0aCB0aGUgbmV3IGF2YXRhciBVUkxcclxuICB1cGRhdGVBdmF0YXIoYXZhdGFyVXJsKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgJHt0aGlzLmJhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsIC8vIFBBVENIIHJlcXVlc3QgZm9yIHBhcnRpYWwgdXBkYXRlc1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBhdmF0YXI6IGF2YXRhclVybCwgLy8gSlNPTiBib2R5IHdpdGggbmV3IGF2YXRhciBVUkxcclxuICAgICAgfSksXHJcbiAgICB9KS5jYXRjaCh0aGlzLl9oYW5kbGVFcnJvcik7IC8vIEhhbmRsZSBlcnJvcnNcclxuICB9XHJcbn1cclxuIiwiLy8gVGhlIFVzZXJJbmZvIGNsYXNzIGlzIHJlc3BvbnNpYmxlIGZvciBtYW5hZ2luZyBhbmQgdXBkYXRpbmcgdXNlciBpbmZvcm1hdGlvbiBvbiB0aGUgcGFnZVxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XHJcbiAgY29uc3RydWN0b3IoeyBuYW1lU2VsZWN0b3IsIGRlc2NyaXB0aW9uU2VsZWN0b3IsIGF2YXRhclNlbGVjdG9yIH0pIHtcclxuICAgIHRoaXMuX25hbWVFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihuYW1lU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5fZGVzY3JpcHRpb25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihkZXNjcmlwdGlvblNlbGVjdG9yKTtcclxuICAgIHRoaXMuX2F2YXRhckVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGF2YXRhclNlbGVjdG9yKTtcclxuICB9XHJcblxyXG4gIC8vIE1ldGhvZCB0byBnZXQgdGhlIGN1cnJlbnQgdXNlciBpbmZvcm1hdGlvbiBmcm9tIHRoZSBwYWdlXHJcbiAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBuYW1lOiB0aGlzLl9uYW1lRWxlbWVudC50ZXh0Q29udGVudCxcclxuICAgICAgZGVzY3JpcHRpb246IHRoaXMuX2Rlc2NyaXB0aW9uRWxlbWVudC50ZXh0Q29udGVudCxcclxuICAgICAgYXZhdGFyOiB0aGlzLl9hdmF0YXJFbGVtZW50LnNyYyxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvLyBNZXRob2QgdG8gdXBkYXRlIHRoZSB1c2VyIGluZm9ybWF0aW9uIG9uIHRoZSBwYWdlXHJcbiAgc2V0VXNlckluZm8oeyBuYW1lLCBkZXNjcmlwdGlvbiwgYXZhdGFyIH0pIHtcclxuICAgIHRoaXMuX25hbWVFbGVtZW50LnRleHRDb250ZW50ID0gbmFtZTtcclxuICAgIHRoaXMuX2Rlc2NyaXB0aW9uRWxlbWVudC50ZXh0Q29udGVudCA9IGRlc2NyaXB0aW9uO1xyXG4gICAgdGhpcy5fYXZhdGFyRWxlbWVudC5zcmMgPSBhdmF0YXI7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoQ29uZmlybWF0aW9uIGV4dGVuZHMgUG9wdXAge1xyXG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcclxuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5jb25maXJtQnV0dG9uID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgIFwiLnBvcHVwX19idXR0b25fY29uZmlybS1kZWxldGVcIlxyXG4gICAgKTtcclxuICAgIHRoaXMuaGFuZGxlQ29uZmlybSA9IG51bGw7IC8vIEluaXRpYWxpemUgdG8gbnVsbCB0byBzdG9yZSB0aGUgY29uZmlybWF0aW9uIGhhbmRsZXJcclxuICB9XHJcblxyXG4gIC8vIFNldCB0aGUgY29uZmlybSBoYW5kbGVyIGR5bmFtaWNhbGx5IGFuZCByZW1vdmUgcHJldmlvdXMgaGFuZGxlcnNcclxuICBzZXRDb25maXJtSGFuZGxlcihoYW5kbGVDb25maXJtKSB7XHJcbiAgICB0aGlzLmhhbmRsZUNvbmZpcm0gPSBoYW5kbGVDb25maXJtO1xyXG5cclxuICAgIC8vIFJlbW92ZSBhbnkgcHJldmlvdXNseSBhZGRlZCBldmVudCBsaXN0ZW5lcnNcclxuICAgIHRoaXMuY29uZmlybUJ1dHRvbi5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5fYm91bmRIYW5kbGVDb25maXJtKTtcclxuXHJcbiAgICAvLyBCaW5kIHRoZSBjb25maXJtIGhhbmRsZXIgYW5kIHN0b3JlIGl0IGZvciBsYXRlciByZW1vdmFsXHJcbiAgICB0aGlzLl9ib3VuZEhhbmRsZUNvbmZpcm0gPSAoKSA9PiB7XHJcbiAgICAgIHRoaXMuaGFuZGxlQ29uZmlybSgpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBBZGQgdGhlIG5ldyBldmVudCBsaXN0ZW5lciBmb3IgdGhlIGNvbmZpcm1hdGlvbiBidXR0b25cclxuICAgIHRoaXMuY29uZmlybUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5fYm91bmRIYW5kbGVDb25maXJtLCB7XHJcbiAgICAgIG9uY2U6IHRydWUsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIE92ZXJyaWRlIHRoZSBzZXRFdmVudExpc3RlbmVycyB0byBzZXQgZGVmYXVsdCBwb3B1cCBiZWhhdmlvcnNcclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7IC8vIEluaGVyaXQgdGhlIGRlZmF1bHQgbGlzdGVuZXJzXHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlY3Rpb24ge1xyXG4gIGNvbnN0cnVjdG9yKHsgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcclxuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XHJcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcclxuICB9XHJcblxyXG4gIC8vIFJlbmRlciBlYWNoIGluIGFycmF5XHJcbiAgcmVuZGVySXRlbXMoaXRlbXMpIHtcclxuICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHRoaXMuX3JlbmRlcmVyKGl0ZW0pKTtcclxuICB9XHJcblxyXG4gIC8vIEFkZCBzaW5nbGUgaXRlbSB0byBjb250YWluZXJcclxuICBhZGRJdGVtKGVsZW1lbnQpIHtcclxuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGVsZW1lbnQpO1xyXG4gIH1cclxufVxyXG4iLCIvLyBJbXBvcnQgdGhlIGJhc2UgUG9wdXAgY2xhc3NcclxuaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XHJcblxyXG4vLyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHRvIGhhbmRsZSBpbWFnZSBwb3B1cHNcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoSW1hZ2UgZXh0ZW5kcyBQb3B1cCB7XHJcbiAgLy8gQ29uc3RydWN0b3IgdGFrZXMgdGhlIHBvcHVwIHNlbGVjdG9yIGFzIGFuIGFyZ3VtZW50XHJcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xyXG4gICAgLy8gQ2FsbCB0aGUgcGFyZW50IGNsYXNzIChQb3B1cCkgY29uc3RydWN0b3Igd2l0aCB0aGUgcG9wdXBTZWxlY3RvclxyXG4gICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XHJcblxyXG4gICAgLy8gU2VsZWN0IHRoZSBpbWFnZSBlbGVtZW50IGluc2lkZSB0aGUgcG9wdXBcclxuICAgIHRoaXMuX2ltYWdlRWxlbWVudCA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19pbWFnZVwiKTtcclxuXHJcbiAgICAvLyBTZWxlY3QgdGhlIGNhcHRpb24gZWxlbWVudCBpbnNpZGUgdGhlIHBvcHVwXHJcbiAgICB0aGlzLl9jYXB0aW9uRWxlbWVudCA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19jYXB0aW9uXCIpO1xyXG4gIH1cclxuXHJcbiAgLy8gTWV0aG9kIHRvIG9wZW4gdGhlIGltYWdlIHBvcHVwIHdpdGggdGhlIHByb3ZpZGVkIG5hbWUgYW5kIGxpbmtcclxuICBvcGVuKHsgbmFtZSwgbGluayB9KSB7XHJcbiAgICAvLyBTZXQgdGhlIGltYWdlIHNvdXJjZSB0byB0aGUgcHJvdmlkZWQgbGlua1xyXG4gICAgdGhpcy5faW1hZ2VFbGVtZW50LnNyYyA9IGxpbms7XHJcblxyXG4gICAgLy8gU2V0IHRoZSBhbHQgdGV4dCBvZiB0aGUgaW1hZ2UgdG8gdGhlIHByb3ZpZGVkIG5hbWVcclxuICAgIHRoaXMuX2ltYWdlRWxlbWVudC5hbHQgPSBuYW1lO1xyXG5cclxuICAgIC8vIFNldCB0aGUgY2FwdGlvbiB0ZXh0IHRvIHRoZSBwcm92aWRlZCBuYW1lXHJcbiAgICB0aGlzLl9jYXB0aW9uRWxlbWVudC50ZXh0Q29udGVudCA9IG5hbWU7XHJcblxyXG4gICAgLy8gQ2FsbCB0aGUgcGFyZW50IGNsYXNzJ3Mgb3BlbiBtZXRob2QgdG8gZGlzcGxheSB0aGUgcG9wdXBcclxuICAgIHN1cGVyLm9wZW4oKTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbImZvcm1WYWxpZGF0aW9uU2V0dGluZ3MiLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwic2VsZWN0b3JzIiwicHJvZmlsZUVkaXRGb3JtIiwiZG9jdW1lbnQiLCJmb3JtcyIsImFkZENhcmRGb3JtIiwiYXZhdGFyRWRpdEZvcm0iLCJxdWVyeVNlbGVjdG9yIiwicHJvZmlsZUVkaXRCdXR0b24iLCJhZGRDYXJkQnV0dG9uIiwicHJvZmlsZVRpdGxlIiwicHJvZmlsZURlc2NyaXB0aW9uIiwicHJvZmlsZVRpdGxlSW5wdXQiLCJwcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsImNhcmRMaXN0RWwiLCJhZGRDYXJkVGl0bGVJbnB1dCIsImFkZENhcmRVcmxJbnB1dCIsIkNhcmQiLCJjb25zdHJ1Y3RvciIsIl9yZWYiLCJjYXJkU2VsZWN0b3IiLCJoYW5kbGVJbWFnZUNsaWNrIiwiY3VycmVudFVzZXJJZCIsImFwaSIsImhhbmRsZURlbGV0ZUNhcmQiLCJuYW1lIiwibGluayIsIl9pZCIsImlzTGlrZWQiLCJsaWtlcyIsIm93bmVyIiwidGhpcyIsIl9uYW1lIiwiX2xpbmsiLCJfaXNMaWtlZCIsIl9saWtlcyIsIl9vd25lciIsIl9jdXJyZW50VXNlcklkIiwiX2NhcmRTZWxlY3RvciIsIl9oYW5kbGVJbWFnZUNsaWNrIiwiX2FwaSIsIl9oYW5kbGVEZWxldGVDYXJkIiwic2V0TGlrZVN0YXRlIiwiX2xpa2VCdXR0b24iLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJ0b2dnbGVMaWtlIiwiZGlzbGlrZUNhcmQiLCJ0aGVuIiwidXBkYXRlZENhcmQiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsImxpa2VDYXJkIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJhZGRFdmVudExpc3RlbmVyIiwiX3RyYXNoQnV0dG9uIiwiX2NhcmRFbGVtZW50IiwiX2NhcmRJbWFnZUVsIiwiZ2V0VmlldyIsImNyZWF0ZUNhcmRFbGVtZW50IiwiY2FyZEVsZW1lbnQiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiX2NhcmRUaXRsZUVsIiwidGV4dENvbnRlbnQiLCJzcmMiLCJhbHQiLCJGb3JtVmFsaWRhdG9yIiwic2V0dGluZ3MiLCJmb3JtRWxlbWVudCIsIl9zZXR0aW5ncyIsIl9mb3JtRWxlbWVudCIsIl9pbnB1dExpc3QiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiX3N1Ym1pdEJ1dHRvbiIsIl9oYXNJbnZhbGlkSW5wdXQiLCJzb21lIiwiaW5wdXRFbGVtZW50IiwidmFsaWRpdHkiLCJ2YWxpZCIsIl90b2dnbGVCdXR0b25TdGF0ZSIsImRpc2FibGVCdXR0b24iLCJkaXNhYmxlZCIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJlcnJvckVsZW1lbnQiLCJpZCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiZm9yRWFjaCIsImVuYWJsZVZhbGlkYXRpb24iLCJyZXNldFZhbGlkYXRpb24iLCJQb3B1cCIsInBvcHVwU2VsZWN0b3IiLCJfcG9wdXBFbGVtZW50IiwiX2hhbmRsZUVzY0Nsb3NlIiwiYmluZCIsIm9wZW4iLCJjbG9zZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJldnQiLCJrZXkiLCJ0YXJnZXQiLCJQb3B1cFdpdGhGb3JtIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInN1cGVyIiwiX3N1Ym1pdEJ0biIsIl9zdWJtaXRCdG5UZXh0IiwiaW5wdXRMaXN0IiwiX19nZXRJbnB1dFZhbHVlcyIsImlucHV0VmFsdWVzIiwiaW5wdXQiLCJ2YWx1ZSIsInJlbmRlckxvYWRpbmciLCJpc0xvYWRpbmciLCJsb2FkaW5nVGV4dCIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsInByZXZlbnREZWZhdWx0IiwicmVzZXRGb3JtIiwicmVzZXQiLCJiYXNlVXJsIiwiaGVhZGVycyIsIl9yZXF1ZXN0IiwidXJsIiwib3B0aW9ucyIsImZldGNoIiwiX2NoZWNrUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiX2hhbmRsZUVycm9yIiwiZ2V0SW5pdGlhbENhcmRzIiwiZ2V0VXNlckluZm8iLCJ1cGRhdGVVc2VySW5mbyIsIl9yZWYyIiwiYWJvdXQiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFkZENhcmQiLCJfcmVmMyIsImRlbGV0ZUNhcmQiLCJjYXJkSWQiLCJ1cGRhdGVBdmF0YXIiLCJhdmF0YXJVcmwiLCJhdmF0YXIiLCJhdXRob3JpemF0aW9uIiwiYXZhdGFyRWRpdEJ1dHRvbiIsInVzZXJJbmZvSW5zdGFuY2UiLCJuYW1lU2VsZWN0b3IiLCJkZXNjcmlwdGlvblNlbGVjdG9yIiwiYXZhdGFyU2VsZWN0b3IiLCJfbmFtZUVsZW1lbnQiLCJfZGVzY3JpcHRpb25FbGVtZW50IiwiX2F2YXRhckVsZW1lbnQiLCJkZXNjcmlwdGlvbiIsInNldFVzZXJJbmZvIiwiZGVsZXRlUG9wdXBJbnN0YW5jZSIsImNvbmZpcm1CdXR0b24iLCJoYW5kbGVDb25maXJtIiwic2V0Q29uZmlybUhhbmRsZXIiLCJfYm91bmRIYW5kbGVDb25maXJtIiwib25jZSIsImNyZWF0ZUNhcmQiLCJjYXJkRGF0YSIsImhhbmRsZUltYWdlUG9wdXAiLCJjYXJkU2VjdGlvbiIsImNvbnRhaW5lclNlbGVjdG9yIiwicmVuZGVyZXIiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwicmVuZGVySXRlbXMiLCJpdGVtcyIsIml0ZW0iLCJhZGRJdGVtIiwiZWxlbWVudCIsInByZXBlbmQiLCJ1c2VySW5mbyIsImNhcmRzIiwicmV2ZXJzZSIsInBpY3R1cmVQb3B1cEluc3RhbmNlIiwicHJvZmlsZUVkaXRQb3B1cEluc3RhbmNlIiwiZm9ybURhdGEiLCJ1cGRhdGVkVXNlckluZm8iLCJmaW5hbGx5IiwiYWRkQ2FyZFBvcHVwSW5zdGFuY2UiLCJ0aXRsZSIsIm5ld0NhcmQiLCJjYXJkRm9ybVZhbGlkYXRvciIsImF2YXRhckVkaXRQb3B1cCIsImF2YXRhckZvcm1WYWxpZGF0b3IiLCJfaW1hZ2VFbGVtZW50IiwiX2NhcHRpb25FbGVtZW50IiwicHJvZmlsZUZvcm1WYWxpZGF0b3IiLCJoYW5kbGVQcm9maWxlRWRpdCIsInVzZXJEYXRhIl0sInNvdXJjZVJvb3QiOiIifQ==